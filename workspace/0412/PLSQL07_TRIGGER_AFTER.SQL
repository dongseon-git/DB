--EMP TRG_LOG 테이블 생성
--DML 명령어가 실행될 경우, EMP_TRG_LOG테이블에 로그 생성
--DML 사용자, DML명령어, 수행된 날짜
--CREATE TABLE EMP_TRG_LOG
--(
--TABLENAME  VARCHAR2(30),
--DML_TYPE   VARCHAR2(20),
--EMPNO      NUMBER(4),
--USER_NAME  VARCHAR2(50),
--CHANGE_DATE DATE
--);
--SYS_CONTEXT('USERENV','SESSION_USER') ": 현재 시스템에 접속 사용
--:NEW.EMPNO : 새로 추가된 EMPNO
CREATE OR REPLACE TRIGGER TRG_EMP_LOG
AFTER
INSERT OR UPDATE OR DELETE ON EMP_TRG
FOR EACH ROW
BEGIN
  IF INSERTING THEN
   INSERT INTO EMP_TRG_LOG
   VALUES ('EMP_TRG','INSERT',:NEW.EMPNO,
   SYS_CONTEXT('USERENV','SESSION_USER'),SYSDATE);
  ELSIF UPDATING THEN
   INSERT INTO EMP_TRG_LOG
   VALUES ('EMP_TRG','UPDATE',:OLD.EMPNO,
   SYS_CONTEXT('USERENV','SESSION_USER'),SYSDATE);
  ELSIF DELETING THEN
   INSERT INTO EMP_TRG_LOG
   VALUES ('EMP_TRG','DELETE',:OLD.EMPNO,
   SYS_CONTEXT('USERENV','SESSION_USER'),SYSDATE);
  END IF;
END;
/

DROP TRIGGER TRG_EMP_LOG;
DROP TABLE EMP_TRG_LOG;


CREATE TABLE EMP_TRG_LOG
(
TABLENAME  VARCHAR2(30),
DML_TYPE   VARCHAR2(20),
EMPNO      NUMBER(4),
USER_NAME  VARCHAR2(50),
CHANGE_DATE DATE
);

--Table EMP_TRG_LOG이(가) 생성되었습니다.
--Trigger TRG_EMP_LOG이(가) 컴파일되었습니다.